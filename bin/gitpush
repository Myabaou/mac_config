#!/bin/sh

# Perform add commit push with git command
# Usage: pushgit.sh "commit message"

# 引数の指定がなかったらエラー終了
if [ $# -eq 0 ]; then
  echo "Usage: pushgit.sh \"commit message\""
  exit 1
fi

GITADD="git add ."
echo "[INFO] ${GITADD}"
$GITADD
GITCOMMIT="[INFO] git commit -m \"$1\""
# 引数の値がうまくとれないのでそのまま実行
git commit -m "$1"
GITPUSH="git push -u origin head"
echo $GITPUSH
$GITPUSH

if [ "$2" == "-f" ]
  then
    echo "[INFO] Creating pull request"
    gh pr create --title "$1" --body "$1" --base main

    echo "[INFO] Merging pull request"
    CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
    PR_NUMBER=$(gh pr list --state open --base main --head $CURRENT_BRANCH --json number | jq -r '.[] | .number')
    gh pr merge $PR_NUMBER
fi
